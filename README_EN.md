# e-mansion claw & analyzer

## Project Overview

e-mansion claw & analyzer is a Python project designed to scrape comment data from the e-mansion website and analyze comments using the Gemini API. It aims to extract advantages, disadvantages, price information, and other valuable insights about real estate properties.

## Project Purpose

This project aims to help users quickly understand user reviews for specific real estate properties. It achieves this by scraping and analyzing forum comments to extract key information, providing a valuable reference for making informed purchasing decisions.

## File Descriptions

*   **caller.py**: The main entry point of the program. It is responsible for calling `scraper.py` to scrape comments, `check_comments.py` to verify comment integrity, and `gemini_analyzer.py` to analyze the comments.
*   **scraper.py**:  Responsible for scraping web page comments from a specified URL and saving the comment data as a JSON file. It supports incremental scraping to avoid redundant scraping of existing comments. The filename now includes the property ID extracted from the URL.
*   **check_comments.py**: Responsible for checking the continuity of comment IDs in the comment JSON file and identifying missing comment IDs. This is used to evaluate the integrity of the scraping results.
*   **gemini_analyzer.py**: Responsible for loading comment JSON files and calling the Google Gemini API to analyze the comments. It extracts advantages, disadvantages, price information, and other valuable information about real estate properties, and saves the analysis results as a JSON file. It now also merges the analysis results using a merge prompt.
*   **analysis_comments_*.json**: JSON result files generated by Gemini API after analyzing comments. The filename includes a timestamp.
*   **comments_*.json**: Raw comment JSON files scraped by `scraper.py`. The filename includes the property ID.
*   **urls.txt**: A text file containing a list of URLs to be scraped, one URL per line.

## Usage

1. **Install Dependencies**: Ensure that the following Python libraries are installed:

    ```bash
    pip install requests beautifulsoup4 google-generativeai
    ```
2. **Configure Gemini API Key**:  You need to set the environment variable `GEMINI_API_KEY` to your Gemini API key.
3. **Run `caller.py`**:
    *   The URL list is now read from the `urls.txt` file. Ensure that the `urls.txt` file is in the same directory and contains the list of URLs to be processed, with each URL on a new line.
    *   Running `caller.py` directly will read the URL list from the `urls.txt` file, scrape comments, check for missing IDs, and perform analysis.

        ```bash
        python caller.py
        ```
    *   Using the `--check-missing` parameter and filename allows you to check for missing IDs in a specified comment JSON file separately.

        ```bash
        python caller.py --check-missing <filename>
        ```

## `caller.py` Parameter Description

*   `--check-missing`: Flag. If set, only checks for missing IDs in the specified file without scraping and analysis.
*   `filename`: Optional parameter. When using `--check-missing`, specify the comment JSON filename to be checked.

## Precautions

*   Ensure a stable network connection so that the program can access the target forum website and Gemini API.
*   Usage of the Gemini API may incur costs. Please be mindful of your API usage quota.
*   Avoid excessively frequent scraping to prevent overloading the target website.

## Project Structure

```
property_claw/
├── analysis_comments_*.json
├── caller.py
├── check_comments.py
├── comments_*.json
├── gemini_analyzer.py
├── scraper.py
├── README_EN.md
├── README.md
├── urls.txt
└── __pycache__/
```

## Example Analysis Result

Below is an example of the JSON result generated by the Gemini API after analyzing comments. It shows the advantages, disadvantages, price information, and other details extracted from property reviews.

```json
{
  "property_name": "ザ・パークハウス 武蔵小杉タワー",
  "information": {
    "advantages": [
      {
        "type": "fact",
        "description": "都心へのアクセスが非常に良い。横須賀線は武蔵小杉に停車しないため、他の多くの駅と比べて片道12～15分短縮できる。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "武蔵小杉は再開発によりさらに発展しており、将来性も高い。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "武蔵小杉は、東横線沿線の中でも特に治安が良い駅が多い。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "武蔵小杉駅周辺には、グランツリーなどの大型商業施設があり、買い物にも便利。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "駅前にグランツリーなどの大型商業施設があり、日用品の買い物にも不自由しない。",
        "confidence_score": 1.0
      },
      {
        "type": "inference",
        "description": "通勤/通学の利便性が高い。目的地までの所要時間が短く、多方面への路線が充実している。",
        "confidence_score": 0.9
      },
      {
        "type": "inference",
        "description": "生活の利便性が高い。駅に近いと街全体を徒歩5分圏内で利用できる。",
        "confidence_score": 0.9
      },
      {
        "type": "inference",
        "description": "子育て環境が良い。習い事の充実など。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "タワーマンションとして高級感があり、設備も良い。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "共有部の高級感はパークタワー品川天王洲以上。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "武蔵小杉は、2050年の東京23区への人口増加率で8位に入るエリアとして、将来性も高い。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "2025年10月完成予定の三井不動産の新築タワーマンション（小杉町一丁目計画）も控えている。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "川崎市は、2024年4月から第二子以降の保育料を無償化している。",
        "confidence_score": 1
      },
      {
        "type": "fact",
        "description": "駅前の再開発で公園整備や商業施設の建設なども計画されている。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "武蔵小杉は災害時のリスクも指摘されるが、タワーマンションは水害などの被害を受けにくく、比較的安全。",
        "confidence_score": 0.7
      },      
      {
        "type": "fact",
        "description": "免震構造で耐震性が高い。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "タワーマンションは共用施設が充実している。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "武蔵小杉周辺には大きな公園があり、子育て環境が良い。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "タワーマンションは高層階からの眺望が良い。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "川崎市は子育て支援に力を入れている。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "免震構造である。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "全熱交換システムで快適。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "アウトフレーム設計のため、部屋が広く感じられる。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "武蔵小杉周辺には大きな病院があり、医療環境も充実している。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "小学校の学区が良い。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "共有部が高級である。",
        "confidence_score": 0.9
      }
    ],
    "disadvantages": [
      {
        "type": "fact",
        "description": "駅から動線上（駅前の道）の信号待ちが結構長い。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "武蔵小杉駅周辺は、土日は人で混雑しやすい。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "駅前のパチンコ屋が景観が悪い。",
        "confidence_score": 0.7
      },
      {
        "type": "fact",
        "description": "南武線沿道は、工場に囲まれた土地で、生活感が強い。",
        "confidence_score": 0.9
      },
      {
        "type": "inference",
        "description": "小学校が遠い。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "新築価格は周辺中古よりも高い。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "エレベーターホールの天井が低い。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "低層階（43階まで）は低層階扱い、44階以上のデラックス・エグゼクティブフロア。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "駐車場がタワーマンションにしては狭い。",
        "confidence_score": 0.7
      },
      {
        "type": "fact",
        "description": "2019年の台風で浸水被害があった。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "北口に駅ビルがなく、買い物利便性が低い。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "低層階は目の前に建物があり眺望が悪い。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "全熱交換ではない部屋もある。",
        "confidence_score": 1.0
      }      
    ],
    "price": [
      {
        "type": "fact",
        "description": "販売価格は平均坪単価600万円～800万円程度。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "70m2で1億2,500万円ほど。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "1LDKは7000万円前後、2LDKは9000万円台から、3LDKは1億円台から。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "1期1次は700m2平均くらい。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "デラックス44階77m2で1.3億円くらい。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "デラックスフロア44階77m2で1.3億円くらい。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "1LDKは45m2で7,000万円弱、60m2で8,000万円台です。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "3LDKで70m2台の物件が1億2,580万円で成約しています。",
        "confidence_score": 1.0
      }
    ],
    "other_information": [
      {
        "type": "inference",
        "description": "湾岸エリアと比較して割高。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "武蔵小杉は、都心主要駅へのダイレクトアクセスカバー率が首都圏随一。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "タワーマンションは地震に強い。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "武蔵小杉は、日本医科大学付属病院や関東労災病院など、大きな病院も多い。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "売主は三井地所レジデンシャル。",
        "confidence_score": 1.0
      },
      {
        "type": "inference",
        "description": "武蔵小杉タワーの共用施設の充実度は武蔵小杉のマンションの中でも最高クラス。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "武蔵小杉は子育てファミリーからDINKS、高齢者まで幅広い層に人気。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "武蔵小杉は再開発が進んでおり、将来的な発展が期待される。",
        "confidence_score": 0.8
      },
      {
        "type": "fact",
        "description": "武蔵小杉周辺には病院が多い。",
        "confidence_score": 0.7
      },
      {
        "type": "fact",
        "description": "2024年3月築。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "総戸数1,400戸を超える大規模タワーマンション。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "武蔵小杉小学校区。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "新築マンションの建設コストは坪300万円くらいです。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "一部の部屋は床暖房が設置されています。",
        "confidence_score": 0.9
      },
      {
        "type": "fact",
        "description": "全熱交換器は設置されていません。",
        "confidence_score": 0.95
      },
      {
        "type": "fact",
        "description": "新空港線の延伸計画があります。",
        "confidence_score": 0.8
      }
    ]
  }
}
