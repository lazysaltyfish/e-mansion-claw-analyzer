# e-mansion claw & analyzer

## Project Overview

e-mansion claw & analyzer is a Python project designed to scrape comment data from the e-mansion website and analyze comments using the Gemini API. It aims to extract advantages, disadvantages, price information, and other valuable insights about real estate properties.

## Project Purpose

This project aims to help users quickly understand user reviews for specific real estate properties. It achieves this by scraping and analyzing forum comments to extract key information, providing a valuable reference for making informed purchasing decisions.

## File Descriptions

* **caller.py**: The main entry point of the program. It is responsible for calling `scraper.py` to scrape comments, `check_comments.py` to verify comment integrity, and `gemini_analyzer.py` to analyze the comments.
* **scraper.py**:  Responsible for scraping web page comments from a specified URL and saving the comment data as a JSON file. It supports incremental scraping to avoid redundant scraping of existing comments.
* **check_comments.py**: Responsible for checking the continuity of comment IDs in the comment JSON file and identifying missing comment IDs. This is used to evaluate the integrity of the scraping results.
* **gemini_analyzer.py**: Responsible for loading comment JSON files and calling the Google Gemini API to analyze the comments. It extracts advantages, disadvantages, price information, and other valuable information about real estate properties, and saves the analysis results as a JSON file.
* **analysis_comments_*.json**: JSON result files generated by Gemini API after analyzing comments. The filename includes a timestamp.
* **comments_*.json**: Raw comment JSON files scraped by `scraper.py`. The filename includes the property ID.

## Usage

1. **Install Dependencies**: Ensure that the following Python libraries are installed:
    ```bash
    pip install requests beautifulsoup4 google-generativeai
    ```
2. **Configure Gemini API Key**:  You need to set the environment variable `GEMINI_API_KEY` to your Gemini API key.
3. **Run `caller.py`**:
    * The URL list is now read from the `urls.txt` file. Ensure that the `urls.txt` file is in the same directory and contains the list of URLs to be processed, with each URL on a new line.
    * Running `caller.py` directly will read the URL list from the `urls.txt` file, scrape comments, check for missing IDs, and perform analysis.
      ```bash
      python caller.py
      ```
    * Using the `--check-missing` parameter and filename allows you to check for missing IDs in a specified comment JSON file separately.
      ```bash
      python caller.py --check-missing <filename>
      ```

## `caller.py` Parameter Description

* `--check-missing`: Flag. If set, only checks for missing IDs in the specified file without scraping and analysis.
* `filename`: Optional parameter. When using `--check-missing`, specify the comment JSON filename to be checked.

## Precautions

* Ensure a stable network connection so that the program can access the target forum website and Gemini API.
* Usage of the Gemini API may incur costs. Please be mindful of your API usage quota.
* Avoid excessively frequent scraping to prevent overloading the target website.

## Project Structure

```
property_claw/
├── analysis_comments_*.json
├── caller.py
├── check_comments.py
├── comments_*.json
├── gemini_analyzer.py
├── scraper.py
├── README_EN.md
├── README.md
└── __pycache__/
```

## Example Analysis Result

Below is an example of the JSON result generated by the Gemini API after analyzing comments. It shows the advantages, disadvantages, price information, and other details extracted from property reviews.

```json
{
  "property_name": "バウス日暮里",
  "information": {
    "advantages": [
      {
        "type": "inference",
        "description": "交通利便性が高い。日暮里駅と西日暮里駅が徒歩圏内で、山手線、京浜東北線、常磐線、千代田線など複数の路線が利用可能。",
        "confidence_score": 0.9
      },
      {
        "type": "inference",
        "description": "駅前に商業施設が多く、生活利便性が高い。",
        "confidence_score": 0.8
      },
      {
        "type": "inference",
        "description": "日暮里、西日暮里周辺の再開発により、将来的な資産価値上昇が期待できる。",
        "confidence_score": 0.7
      },
      {
        "type": "inference",
        "description": "ファミリー層にとって子育てしやすい環境。",
        "confidence_score": 0.7
      },
      {
        "type": "inference",
        "description": "全戸トランクルーム完備、ゲストルームや駐車場など共用施設が充実している。",
        "confidence_score": 0.8
      },
      {
        "type": "inference",
        "description": "静かな環境。",
        "confidence_score": 0.6
      },
      {
        "type": "inference",
        "description": "植栽や共用施設が充実している。",
        "confidence_score": 0.7
      }
    ],
    "disadvantages": [
      {
        "type": "inference",
        "description": "価格が高い。坪単価600万円以上と予想され、周辺の中古マンションと比べて割高。",
        "confidence_score": 0.9
      },
      {
        "type": "inference",
        "description": "大規模商業施設が少ない。",
        "confidence_score": 0.6
      },
      {
        "type": "inference",
        "description": "線路に近い部屋は騒音や排気ガスが気になる可能性がある。",
        "confidence_score": 0.7
      },
      {
        "type": "inference",
        "description": "ハザードマップに要注意。",
        "confidence_score": 0.7
      },
      {
        "type": "inference",
        "description": "管理費、修繕積立金、固定資産税が高い可能性がある。",
        "confidence_score": 0.7
      }
    ],
    "price": [
      {
        "type": "inference",
        "description": "坪単価600万円以上と予想される。",
        "confidence_score": 0.8
      },
      {
        "type": "inference",
        "description": "3LDK70平米で1億1千万円程度になる可能性がある。",
        "confidence_score": 0.7
      },
      {
        "type": "inference",
        "description": "75平米で1億2000万円～1億3000万円程度と予想される。",
        "confidence_score": 0.7
      },
      {
        "type": "inference",
        "description": "78平米、3LDKで1億2000万円程度になる可能性がある。",
        "confidence_score": 0.7
      }
    ],
    "other_information": [
      {
        "type": "fact",
        "description": "ルジェンテ西日暮里が坪400万円台、オープレジデンシア西日暮里ステーションフロント（中古）が1億円近くで売り出されている。",
        "confidence_score": 1.0
      },
      {
        "type": "fact",
        "description": "イニシア日暮里が坪510万円程度で販売されていた。",
        "confidence_score": 0.9
      },
      {
        "type": "inference",
        "description": "近隣築浅中古マンションで450万円前後、駅直結タワーマンションで600万円ぐらいの価格帯。",
        "confidence_score": 0.8
      },
      {
        "type": "inference",
        "description": "日暮里は駅力、都心アクセス力、周辺環境、再開発の有無などを考慮すると、割安感がある。",
        "confidence_score": 0.7
      },
      {
        "type": "fact",
        "description": "2030年に西日暮里駅再開発、2031年に東山手ルート開業予定。",
        "confidence_score": 1.0
      },
      {
        "type": "inference",
        "description": "周辺に築浅のスーパーやおしゃれなカフェ付き分譲マンションもある。",
        "confidence_score": 0.7
      },
      {
        "type": "fact",
        "description": "地下にできるのは駐車場ではなく駐輪場。",
        "confidence_score": 1.0
      },
      {
        "type": "inference",
        "description": "元々は寿屋という会社が持っていた土地で、3分の1ぐらいを中央日本土地建物が取得。寿屋は残る土地で賃貸マンション（単身世帯中心）を新たに建てる予定。バウスはファミリー世帯中心。なお、寿屋は近隣に賃貸マンションを過去に手掛けている。",
        "confidence_score": 0.8
      }
    ]
  }
}
```
